---
title: Supplemental Methods for LD filtering
documentclass: scrartcl
classoption: letterpaper
geometry: margin=1in
toc: 1
graphics: 1
tags: [manuscript, methods, ddRAD58]
bibliography: methods.bib
csl: ../plos.csl
read: "+simple_tables+table_captions+footnotes+inline_notes+fenced_code_blocks+fenced_code_attributes+fancy_lists+definition_lists+superscript+subscript+tex_math_dollars"
header-includes: 
- \usepackage{fontspec}
- \setmainfont{Linux Libertine O}
...

<!-- # Linkage measurements #

Plink version 1.9 [@Chang2015] was used to calculate pairwise linkage disequilibrium (LD) as $r$ for all SNP-pairs located on common supercontigs.
The `--allow-extra-chr` option was required to handle the number of supercontigs.
Unless stated otherwise, all subsequent analysis pertaining to LD used $r^2$.
 -->

# LD-based filtering of SNP-pairs #

The LD values of SNP-pairs were compared after binning SNP-pairs by base pair separation to control for unknown rates of recombination in _G. f. fuscipes_.
Bin length was set at 50 bp with the lower bound inclusive and higher bound exclusive. 
In other words the bins were defined as $[i, i + 49)$ where $i \in \{1,1(50),2(50),3(50) ... n(50)\}$ and $n$ is a positive integer.

To identify SNP-pairs for further investigation in an arbitrary set of binned SNP-pairs, we needed to assign probabilities to each SNP-pair in the bin. 
The distributions of binned SNP-pairs are bounded by 0 and 1 and do not appear to be Normal in shape.
Additionally, in many cases, the data appear to exhibit peaks at both the lower and upper $r^2$ range.
This suggested that the data may be modeled well using the probability density function (PDF) of the Beta distribution:

$$f(x;\alpha,\beta) = \frac{x^{\alpha-1}(1-x)^{\beta-1}} {\mathrm{B}(\alpha,\beta)}$$

with shape parameters $\alpha$ and $\beta$ and where $x$ represents an observed value generated by the distribution and $\mathrm{B}()$ is the Beta function.


The Beta's cumulative distribution function (CDF): 

$$F(x;\alpha,\beta) = \frac{\mathrm{B}(x;\alpha,\beta)}{\mathrm{B}(\alpha,\beta)} $$

can be used to describe the probability that a binned SNP-pair will be observed to have an $r^2 \le x$.
It follows that $1-\mathrm{CDF}$ represents the probability of observing a more extreme value.

For each set of binned $r^2$ values, the SNP-pairs deemed worthy of further investigation were defined as those where $1-\mathrm{CDF} \le 0.01$ after Benjamini-Hochberg (BH) correction for multiple testing [@Benjamini1995].

## Scaling of binned $r^2$ distributions ##

The Beta distribution is bounded on the non-inclusive interval between 0 and 1.
However, there are data in each bin that may have been assigned values of exactly 0 or 1.
It is likely that these values are not truly 0 or 1 in the discrete binary sense that a coin-flip is _either_ heads or tails.
Therefore, the all data for each bin were scaled according to the following scheme 

$$((x_i - 0.5)\cdot \theta) + 0.5$$

in order to symmetrically shrink the distribution of values to fit within the open interval $(0,1)$.
In the scheme above, let $x_i$ stand for the $r^2$ of each SNP-pair in an arbitrary bin set and $\theta$ stand for the scaling factor.
The relevant results in this paper used $\theta = 0.999$.

## Bayesian parameter estimation using the binned $r^2$ distributions ##

In order to use the CDF of the Beta distribution to assign significances to each observed SNP-pair in a bin, it is necessary to learn the distribution parameters ($\alpha$ and $\beta$) for each bin given the specific data in each bin.
For this we used custom python code that made heavy use of the following third-party data analysis modules: Pandas [@mckinney-proc-scipy-2010], NumPy [@VanDerWalt2011], SciPy [@Jones2001scipy], pyMC [@Patil2010pymc],  and StatsModels  [@statsmodels].

We used pyMC to build the model of the Beta distribution and use it to exploit the bin-specific data to estimate the bin-specific values for the $\alpha$ and $\beta$ parameters of the model [Figure fig_betamod].
The values of $\alpha$ and $\beta$ were modeled with separate Uniform prior distributions from 0.01 to 10.
This model topology was used to create pyMC "model" objects and initialized with the $r^2$ data from each bin.
The parameters of each Beta distribution were then estimated by _maximum a posteriori_ (MAP) and used to calculate the $1-\mathrm{CDF}$ for each SNP-pair in each bin [@Jones2001scipy;@VanDerWalt2011].
The $1-\mathrm{CDF}$ values were then BH corrected by bin and filtered with a threshold of $(1-CDF)_{BH} \le 0.01$ using statsmodels [@Benjamini1995].

# Code availability #

The code used to run this and other parts of the analyses described in this manuscript may be found on github at the following project address.

[https://github.com/CacconeLabYale/gloria_soria_ddRAD_2015](https://github.com/CacconeLabYale/gloria_soria_ddRAD_2015)


<div id="fig_betamod">
![__[fig_betamod]Network representation of the LD Beta model:__ Ovals represent modeled probability distributions. Circles represent learned parameters. Grey shading indicates use of observed data. \label{fig_betamod}](../figures/bin_MAP_model.png)

</div>

<!-- ################################# -->
\newpage
<!-- ################################# -->

# Bibliography #